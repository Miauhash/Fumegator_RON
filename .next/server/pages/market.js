(()=>{var e={};e.id=5776,e.ids=[5776,2888,660],e.modules={7361:e=>{e.exports={canvas:"MarketPage_canvas__J_ofk",container:"MarketPage_container__WEJIP",header:"MarketPage_header__gdyXr",title:"MarketPage_title__O7re_",backButton:"MarketPage_backButton__3xLLJ",centerText:"MarketPage_centerText__lS6hr",accessDenied:"MarketPage_accessDenied__joc8k",marketGrid:"MarketPage_marketGrid__i0g1M",card:"MarketPage_card__bScgp",openMarketCard:"MarketPage_openMarketCard__77FSw",form:"MarketPage_form__pQFZs",formGroup:"MarketPage_formGroup__WFOYd",input:"MarketPage_input__xJj_4",balanceText:"MarketPage_balanceText__1NbY4",button:"MarketPage_button__bcTn0",balanceInfo:"MarketPage_balanceInfo__Lg1R9",grid:"MarketPage_grid__zzcAK",listingCard:"MarketPage_listingCard__Qqgwt",cardHeader:"MarketPage_cardHeader__V0xoM",cardBody:"MarketPage_cardBody__31CX4",totalCost:"MarketPage_totalCost__Krmjm",seller:"MarketPage_seller__pIWzv",notification:"MarketPage_notification__ywFtI",success:"MarketPage_success__7ZoBx",error:"MarketPage_error__sUERN"}},3371:(e,a,t)=>{"use strict";t.r(a),t.d(a,{config:()=>y,default:()=>f,getServerSideProps:()=>S,getStaticPaths:()=>P,getStaticProps:()=>b,reportWebVitals:()=>N,routeModule:()=>T,unstable_getServerProps:()=>C,unstable_getServerSideProps:()=>I,unstable_getStaticParams:()=>w,unstable_getStaticPaths:()=>v,unstable_getStaticProps:()=>M});var r={};t.r(r),t.d(r,{default:()=>MarketPage});var s=t(7093),n=t(5244),c=t(1323),i=t(4003),o=t(9597),l=t(997),d=t(6689),m=t(968),u=t.n(m),h=t(1664),p=t.n(h),x=t(9142),g=t(1178),_=t(7361),k=t.n(_);let j=["INSULINE","ZOLGENSMA","LUXUTURNA","ZYNTEGLO"];function MarketPage(){let{userAddress:e}=(0,g.U)(),[a,t]=(0,d.useState)(!1),[r,s]=(0,d.useState)(!0),[n,c]=(0,d.useState)([]),[i,o]=(0,d.useState)({}),[m,h]=(0,d.useState)({message:"",type:""}),[_,f]=(0,d.useState)({}),[b,P]=(0,d.useState)({tokenType:j[0],amount:"",pricePerUnitInVIDA:""}),showFeedback=(e,a)=>{h({message:e,type:a}),setTimeout(()=>h({message:"",type:""}),5e3)},fetchData=async e=>{if(e){f({});try{let[a,t]=await Promise.all([fetch("/api/market/listings"),(0,x.u)(e)]);if(!a.ok)throw Error("Falha ao carregar an\xfancios.");let r=await a.json();c(r),t&&t.balances?o(t.balances):o({})}catch(e){showFeedback(e.message,"error")}}};(0,d.useEffect)(()=>{e?(async()=>{try{let a=await fetch(`/api/market/check-access?wallet=${e}`);if(!a.ok)throw t(!1),Error("Falha na verifica\xe7\xe3o de acesso.");let{access:r}=await a.json();t(r),r&&await fetchData(e)}catch(e){console.error(e.message)}finally{s(!1)}})():s(!1)},[e]);let handleCreateListing=async a=>{a.preventDefault(),f({form:!0});try{let a=await fetch("/api/market/create",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({sellerWallet:e,...b})}),t=await a.json();if(!a.ok)throw Error(t.message);showFeedback("An\xfancio criado com sucesso!","success"),P({tokenType:j[0],amount:"",pricePerUnitInVIDA:""}),await fetchData(e)}catch(e){showFeedback(e.message,"error")}finally{f({})}},handleBuyListing=async a=>{if(window.confirm("Voc\xea confirma a compra deste item?")){f({[a]:!0});try{let t=await fetch("/api/market/buy",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({buyerWallet:e,listingId:a})}),r=await t.json();if(!t.ok)throw Error(r.message);showFeedback("Compra realizada com sucesso!","success"),await fetchData(e)}catch(e){showFeedback(e.message,"error")}finally{f({})}}},handleFormChange=e=>{let{name:a,value:t}=e.target;P(e=>({...e,[a]:t}))};return(0,l.jsxs)("div",{className:k().canvas,children:[l.jsx(u(),{children:l.jsx("title",{children:"Mercado - Hospital Fumegator"})}),(0,l.jsxs)("div",{className:k().container,children:[(0,l.jsxs)("header",{className:k().header,children:[l.jsx("h1",{className:k().title,children:"Mercado de Recursos"}),l.jsx(p(),{href:"/game",passHref:!0,children:l.jsx("button",{className:k().backButton,children:"Voltar ao Jogo"})})]}),l.jsx("main",{children:r?l.jsx("p",{className:k().centerText,children:"Verificando acesso ao mercado..."}):e?a?(0,l.jsxs)("div",{className:k().marketGrid,children:[(0,l.jsxs)("section",{className:k().card,children:[l.jsx("h2",{children:"Vender Recursos"}),(0,l.jsxs)("form",{onSubmit:handleCreateListing,className:k().form,children:[(0,l.jsxs)("div",{className:k().formGroup,children:[l.jsx("label",{children:"Recurso para Vender"}),l.jsx("select",{name:"tokenType",value:b.tokenType,onChange:handleFormChange,className:k().input,children:j.map(e=>l.jsx("option",{value:e,children:e},e))}),(0,l.jsxs)("span",{className:k().balanceText,children:["Saldo: ",(i[b.tokenType]||0).toFixed(4)]})]}),(0,l.jsxs)("div",{className:k().formGroup,children:[l.jsx("label",{children:"Quantidade"}),l.jsx("input",{name:"amount",type:"number",step:"any",value:b.amount,onChange:handleFormChange,className:k().input,placeholder:"ex: 1000",required:!0})]}),(0,l.jsxs)("div",{className:k().formGroup,children:[l.jsx("label",{children:"Pre\xe7o por Unidade (em VIDA)"}),l.jsx("input",{name:"pricePerUnitInVIDA",type:"number",step:"any",value:b.pricePerUnitInVIDA,onChange:handleFormChange,className:k().input,placeholder:"ex: 0.5",required:!0})]}),l.jsx("button",{type:"submit",className:k().button,disabled:_.form,children:_.form?"Criando...":"Criar An\xfancio"})]}),(0,l.jsxs)("div",{className:k().balanceInfo,children:["Seu Saldo de VIDA: ",l.jsx("strong",{children:(i.VIDA||0).toFixed(4)})]})]}),(0,l.jsxs)("section",{className:`${k().card} ${k().openMarketCard}`,children:[l.jsx("h2",{children:"Mercado Aberto"}),l.jsx("div",{className:k().grid,children:n.length>0?n.map(a=>{let t=a.amount*a.pricePerUnitInVIDA;return(0,l.jsxs)("div",{className:k().listingCard,children:[(0,l.jsxs)("div",{className:k().cardHeader,children:["Vendendo: ",(0,l.jsxs)("strong",{children:[a.amount.toLocaleString()," ",a.tokenType]})]}),(0,l.jsxs)("div",{className:k().cardBody,children:[(0,l.jsxs)("p",{children:["Pre\xe7o/un: ",a.pricePerUnitInVIDA," VIDA"]}),(0,l.jsxs)("p",{className:k().totalCost,children:["Custo Total: ",t.toFixed(2)," VIDA"]}),(0,l.jsxs)("p",{className:k().seller,children:["Vendedor: ",a.sellerWallet.slice(0,4),"...",a.sellerWallet.slice(-4)]})]}),l.jsx("button",{className:k().button,onClick:()=>handleBuyListing(a.id),disabled:_[a.id]||a.sellerWallet===e,children:a.sellerWallet===e?"Seu An\xfancio":_[a.id]?"Comprando...":"Comprar"})]},a.id)}):l.jsx("p",{className:k().centerText,children:"O mercado est\xe1 vazio no momento. Seja o primeiro a vender!"})})]})]}):(0,l.jsxs)("div",{className:k().accessDenied,children:[l.jsx("h2",{children:"Acesso Restrito"}),l.jsx("p",{children:"Para garantir a seguran\xe7a e a seriedade das transa\xe7\xf5es, o acesso ao mercado \xe9 restrito a jogadores que possuem ao menos um NFT de raridade Rara, \xc9pica ou Lend\xe1ria."})]}):l.jsx("p",{className:k().centerText,children:"Conecte sua carteira para acessar o mercado."})})]}),m.message&&l.jsx("div",{className:`${k().notification} ${k()[m.type]}`,children:m.message})]})}let f=(0,c.l)(r,"default"),b=(0,c.l)(r,"getStaticProps"),P=(0,c.l)(r,"getStaticPaths"),S=(0,c.l)(r,"getServerSideProps"),y=(0,c.l)(r,"config"),N=(0,c.l)(r,"reportWebVitals"),M=(0,c.l)(r,"unstable_getStaticProps"),v=(0,c.l)(r,"unstable_getStaticPaths"),w=(0,c.l)(r,"unstable_getStaticParams"),C=(0,c.l)(r,"unstable_getServerProps"),I=(0,c.l)(r,"unstable_getServerSideProps"),T=new s.PagesRouteModule({definition:{kind:n.x.PAGES,page:"/market",pathname:"/market",bundlePath:"",filename:""},components:{App:o.default,Document:i.default},userland:r})},4003:(e,a,t)=>{"use strict";t.r(a),t.d(a,{default:()=>Document});var r=t(997),s=t(6859);function Document(){return(0,r.jsxs)(s.Html,{lang:"pt-BR",children:[r.jsx(s.Head,{children:r.jsx("meta",{name:"google-adsense-account",content:"ca-pub-8822559687614116"})}),(0,r.jsxs)("body",{children:[r.jsx(s.Main,{}),r.jsx(s.NextScript,{})]})]})}},2785:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/pages.runtime.prod.js")},968:e=>{"use strict";e.exports=require("next/head")},6689:e=>{"use strict";e.exports=require("react")},997:e=>{"use strict";e.exports=require("react/jsx-runtime")},1017:e=>{"use strict";e.exports=require("path")}};var a=require("../webpack-runtime.js");a.C(e);var __webpack_exec__=e=>a(a.s=e),t=a.X(0,[6859,8450,8760,5588,1664,9597,9142],()=>__webpack_exec__(3371));module.exports=t})();