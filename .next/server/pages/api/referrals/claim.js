"use strict";(()=>{var e={};e.id=2876,e.ids=[2876],e.modules={3524:e=>{e.exports=require("@prisma/client")},145:e=>{e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},3585:(e,r,a)=>{a.r(r),a.d(r,{config:()=>c,default:()=>n,routeModule:()=>m});var t={};a.r(t),a.d(t,{default:()=>handler});var s=a(1802),i=a(7153),o=a(6249),l=a(7864);async function handler(e,r){if("POST"!==e.method)return r.status(405).end();let{wallet:a}=e.body;if(!a)return r.status(400).json({error:"Wallet \xe9 obrigat\xf3ria"});try{let e=await l.Z.$transaction(async e=>{let r=await e.referral.count({where:{referrer:a,claimed:!1}});if(0===r)throw Error("Nenhuma recompensa para coletar.");let t=3600*r,s=await e.gameState.findUnique({where:{wallet:a}});if(!s)throw Error("Usu\xe1rio n\xe3o encontrado.");let i=JSON.parse(s.state||"{}"),o=!1;for(let e in i.timers)i.timers[e]>0&&(i.timers[e]=Math.max(0,i.timers[e]-t),o=!0);if(!o)throw Error("Nenhuma minera\xe7\xe3o ativa para acelerar. Comece a minerar e colete depois.");return await e.gameState.update({where:{wallet:a},data:{state:JSON.stringify(i)}}),await e.referral.updateMany({where:{referrer:a,claimed:!1},data:{claimed:!0}}),{claimedAmount:r}});r.status(200).json({success:!0,message:`Voc\xea coletou ${e.claimedAmount} hora(s) de acelera\xe7\xe3o!`})}catch(e){console.error("Erro ao coletar recompensas:",e),r.status(400).json({success:!1,error:e.message})}}let n=(0,o.l)(t,"default"),c=(0,o.l)(t,"config"),m=new s.PagesAPIRouteModule({definition:{kind:i.x.PAGES_API,page:"/api/referrals/claim",pathname:"/api/referrals/claim",bundlePath:"",filename:""},userland:t})},7864:(e,r,a)=>{let t;a.d(r,{Z:()=>i});var s=a(3524);console.log("INICIALIZANDO PRISMA CLIENT. CONECTANDO AO BANCO DE DADOS:",process.env.DATABASE_URL),global.prisma||(global.prisma=new s.PrismaClient),t=global.prisma;let i=t}};var r=require("../../../webpack-api-runtime.js");r.C(e);var __webpack_exec__=e=>r(r.s=e),a=r.X(0,[4222],()=>__webpack_exec__(3585));module.exports=a})();