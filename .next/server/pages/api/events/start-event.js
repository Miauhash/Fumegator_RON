"use strict";(()=>{var e={};e.id=6469,e.ids=[6469],e.modules={3524:e=>{e.exports=require("@prisma/client")},145:e=>{e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},5036:(e,t,a)=>{a.r(t),a.d(t,{config:()=>d,default:()=>o,routeModule:()=>u});var r={};a.r(r),a.d(r,{default:()=>handler});var s=a(1802),n=a(7153),i=a(6249),l=a(7864);async function handler(e,t){try{let e=await l.Z.globalEvent.findFirst({where:{isActive:!0}}),a=await l.Z.globalEvent.count(),r=e?e.id:a,s=r%a+1;e&&await l.Z.globalEvent.update({where:{id:e.id},data:{isActive:!1}});let n=new Date;n.setDate(n.getDate()+(7-n.getDay())%7),n.setHours(23,59,59,999),await l.Z.globalEvent.update({where:{id:s},data:{isActive:!0,endsAt:n,currentAmount:0}}),await l.Z.eventContribution.deleteMany({where:{eventId:s}}),t.status(200).json({success:!0,message:`Event ${s} started.`})}catch(e){console.error("Error starting weekly event:",e),t.status(500).json({success:!1,error:"Internal server error"})}}let o=(0,i.l)(r,"default"),d=(0,i.l)(r,"config"),u=new s.PagesAPIRouteModule({definition:{kind:n.x.PAGES_API,page:"/api/events/start-event",pathname:"/api/events/start-event",bundlePath:"",filename:""},userland:r})},7864:(e,t,a)=>{let r;a.d(t,{Z:()=>n});var s=a(3524);console.log("INICIALIZANDO PRISMA CLIENT. CONECTANDO AO BANCO DE DADOS:",process.env.DATABASE_URL),global.prisma||(global.prisma=new s.PrismaClient),r=global.prisma;let n=r}};var t=require("../../../webpack-api-runtime.js");t.C(e);var __webpack_exec__=e=>t(t.s=e),a=t.X(0,[4222],()=>__webpack_exec__(5036));module.exports=a})();