"use strict";(()=>{var e={};e.id=5569,e.ids=[5569],e.modules={3524:e=>{e.exports=require("@prisma/client")},145:e=>{e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},9532:(e,a,t)=>{t.r(a),t.d(a,{config:()=>d,default:()=>l,routeModule:()=>u});var r={};t.r(r),t.d(r,{default:()=>handler});var n=t(1802),o=t(7153),s=t(6249),i=t(7864);async function handler(e,a){if("POST"!==e.method)return a.status(405).json({message:"M\xe9todo n\xe3o permitido."});let{wallet:t,eventId:r,amount:n}=e.body,o=parseFloat(n);if(!t||!r||isNaN(o)||o<=0)return a.status(400).json({message:"Dados inv\xe1lidos fornecidos."});try{let e=await i.Z.$transaction(async e=>{let a=await e.globalEvent.findUnique({where:{id:r}});if(!a||!a.isActive)throw Error("Este evento n\xe3o est\xe1 ativo.");let n=await e.gameState.findUnique({where:{wallet:t}});if(!n)throw Error("Jogador n\xe3o encontrado.");let s=n.state,i=s.balances?.[a.targetToken]||0;if(i<o)throw Error(`Saldo insuficiente de ${a.targetToken}.`);return s.balances[a.targetToken]-=o,await e.gameState.update({where:{wallet:t},data:{state:s}}),await e.globalEvent.update({where:{id:r},data:{currentAmount:{increment:o}}}),await e.eventContribution.create({data:{userWallet:t,eventId:r,amount:o}}),{newBalance:s.balances[a.targetToken]}});a.status(200).json({message:"Contribui\xe7\xe3o registrada com sucesso!",newBalance:e.newBalance})}catch(e){console.error("Erro ao processar contribui\xe7\xe3o:",e),a.status(500).json({message:e.message||"Erro interno no servidor."})}}let l=(0,s.l)(r,"default"),d=(0,s.l)(r,"config"),u=new n.PagesAPIRouteModule({definition:{kind:o.x.PAGES_API,page:"/api/events/contribute",pathname:"/api/events/contribute",bundlePath:"",filename:""},userland:r})},7864:(e,a,t)=>{let r;t.d(a,{Z:()=>o});var n=t(3524);console.log("INICIALIZANDO PRISMA CLIENT. CONECTANDO AO BANCO DE DADOS:",process.env.DATABASE_URL),global.prisma||(global.prisma=new n.PrismaClient),r=global.prisma;let o=r}};var a=require("../../../webpack-api-runtime.js");a.C(e);var __webpack_exec__=e=>a(a.s=e),t=a.X(0,[4222],()=>__webpack_exec__(9532));module.exports=t})();