"use strict";(()=>{var e={};e.id=6797,e.ids=[6797],e.modules={3524:e=>{e.exports=require("@prisma/client")},145:e=>{e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},8798:(e,t,r)=>{r.r(t),r.d(t,{config:()=>u,default:()=>l,routeModule:()=>d});var a={};r.r(a),r.d(a,{default:()=>handler});var s=r(1802),n=r(7153),o=r(6249),i=r(7864);async function handler(e,t){if("POST"!==e.method)return t.setHeader("Allow",["POST"]),t.status(405).json({error:"Method Not Allowed"});let{wallet:r,eventId:a,progressAmount:s}=e.body;if(!r||!a||null==s||s<=0)return t.status(400).json({error:"Missing required or invalid fields"});try{let e=await i.Z.globalEvent.findUnique({where:{id:a}});if(!e)return t.status(404).json({error:"Event not found."});let n=e.targetToken,o=await i.Z.gameState.findUnique({where:{wallet:r}});if(!o)return t.status(404).json({error:"Player state not found."});let l=o.state.balances||{},u=l[n]||0;if(u<s)return t.status(400).json({error:"Insufficient balance to contribute."});await i.Z.$transaction([i.Z.gameState.update({where:{wallet:r},data:{state:{...o.state,balances:{...o.state.balances,[n]:u-s}}}}),i.Z.eventContribution.create({data:{userWallet:r,eventId:a,amount:s}}),i.Z.globalEvent.update({where:{id:a},data:{currentAmount:{increment:s}}})]),t.status(200).json({success:!0,message:"Contribution successful!"})}catch(e){console.error("API Error updating progress:",e),t.status(500).json({success:!1,error:"Internal Server Error"})}}let l=(0,o.l)(a,"default"),u=(0,o.l)(a,"config"),d=new s.PagesAPIRouteModule({definition:{kind:n.x.PAGES_API,page:"/api/events/progress",pathname:"/api/events/progress",bundlePath:"",filename:""},userland:a})},7864:(e,t,r)=>{let a;r.d(t,{Z:()=>n});var s=r(3524);console.log("INICIALIZANDO PRISMA CLIENT. CONECTANDO AO BANCO DE DADOS:",process.env.DATABASE_URL),global.prisma||(global.prisma=new s.PrismaClient),a=global.prisma;let n=a}};var t=require("../../../webpack-api-runtime.js");t.C(e);var __webpack_exec__=e=>t(t.s=e),r=t.X(0,[4222],()=>__webpack_exec__(8798));module.exports=r})();