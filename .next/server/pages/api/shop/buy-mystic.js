"use strict";(()=>{var e={};e.id=485,e.ids=[485],e.modules={3524:e=>{e.exports=require("@prisma/client")},145:e=>{e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},7641:(e,r,t)=>{t.r(r),t.d(r,{config:()=>h,default:()=>u,routeModule:()=>p});var a={};t.r(a),t.d(a,{default:()=>handler});var o=t(1802),s=t(7153),n=t(6249),i=t(7864),d=t(6617);!function(){var e=Error("Cannot find module 'ethers'");throw e.code="MODULE_NOT_FOUND",e}();let c=process.env.RONIN_CLUSTER||"saigon",l=Object(function(){var e=Error("Cannot find module 'ethers'");throw e.code="MODULE_NOT_FOUND",e}()).providers.JsonRpcProvider("mainnet"===c?"https://api.roninchain.com/rpc":"https://saigon-testnet.roninchain.com/rpc");async function handler(e,r){if("POST"!==e.method)return r.status(405).json({message:"Method Not Allowed"});let{wallet:t,signature:a}=e.body;if(!t||!a)return r.status(400).json({message:"Wallet and transaction hash are required."});try{let e=await l.getTransactionReceipt(a);if(!e)throw Error("Transaction not found on the blockchain yet.");if(1!==e.status)throw Error("Payment transaction failed (reverted).");let o=await l.getTransaction(a),s=Object(function(){var e=Error("Cannot find module 'ethers'");throw e.code="MODULE_NOT_FOUND",e}()).utils.parseEther("15.0");if(!o||"ronin:583f863de13c33a97b587797b76b255e834a65ac"!==o.to.toLowerCase()||o.from.toLowerCase()!==t.toLowerCase()||!o.value.eq(s))throw Error("Payment transaction details are invalid.");let n=await i.Z.rewardNft.findFirst({where:{isAwarded:!1,rarity:"Mystic"},select:{id:!0,name:!0,imageUrl:!0,contractAddress:!0,tokenId:!0}});if(!n)throw Error("No Mystic NFTs available in the reward pool. Please contact support.");await (0,d.Q)(t,n.contractAddress,n.tokenId),await i.Z.rewardNft.update({where:{id:n.id},data:{isAwarded:!0,ownerWallet:t}}),r.status(200).json({success:!0,message:"Purchase successful!",newlyMintedNft:{name:n.name,image:n.imageUrl,address:n.contractAddress,tokenId:n.tokenId,rarity:"Mystic"}})}catch(e){console.error("[Buy Mystic API Error]:",e),r.status(500).json({message:e.message||"An internal server error occurred."})}}let u=(0,n.l)(a,"default"),h=(0,n.l)(a,"config"),p=new o.PagesAPIRouteModule({definition:{kind:s.x.PAGES_API,page:"/api/shop/buy-mystic",pathname:"/api/shop/buy-mystic",bundlePath:"",filename:""},userland:a})}};var r=require("../../../webpack-api-runtime.js");r.C(e);var __webpack_exec__=e=>r(r.s=e),t=r.X(0,[4222,4045],()=>__webpack_exec__(7641));module.exports=t})();