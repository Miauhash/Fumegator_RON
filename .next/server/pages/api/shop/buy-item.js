"use strict";(()=>{var e={};e.id=3988,e.ids=[3988],e.modules={145:e=>{e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},6946:(e,t,i)=>{i.r(t),i.d(t,{config:()=>p,default:()=>m,routeModule:()=>c});var a={};i.r(a),i.d(a,{default:()=>handler});var s=i(1802),r=i(7153),n=i(6249);async function loadGameState(e){if(!e)return null;try{let t=await fetch(`/api/player?wallet=${e}`);if(404===t.status)return console.log("Nenhum estado de jogo encontrado para o jogador. Iniciando um novo."),null;if(!t.ok)throw Error(`Falha na API de carregamento. Status: ${t.status}`);let i=await t.json();return i.gameState||null}catch(e){return console.error("Erro cr\xedtico em loadGameState:",e),null}}async function saveGameState(e,t){if(e&&t)try{await fetch("/api/player",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({wallet:e,gameState:t})})}catch(e){console.error("Erro em saveGameState:",e)}}require("react/jsx-runtime"),require("react");var o=i(9716);let getShopItems=e=>[{id:"time_accelerator_5m",name:(0,o.t)("shop_item_accel_5m_name",e),description:(0,o.t)("shop_item_accel_desc",e),price:150,currency:"INSU",type:"EQUIPMENT",buffName:"timeAccelerator",duration:3e5,image:"/img/shop/itens/vacina.gif"},{id:"time_accelerator_15m",name:(0,o.t)("shop_item_accel_15m_name",e),description:(0,o.t)("shop_item_accel_desc",e),price:10,currency:"ZOLG",type:"EQUIPMENT",buffName:"timeAccelerator",duration:9e5,image:"/img/shop/itens/vacina.gif"},{id:"time_accelerator_60m",name:(0,o.t)("shop_item_accel_60m_name",e),description:(0,o.t)("shop_item_accel_desc",e),price:15,currency:"VIDA",type:"EQUIPMENT",buffName:"timeAccelerator",duration:36e5,image:"/img/shop/itens/vacina.gif"},{id:"ad_free_boost_10m",name:(0,o.t)("shop_item_boost_10m_name",e),description:(0,o.t)("shop_item_boost_desc",e),price:18,currency:"VIDA",type:"EQUIPMENT",buffName:"adFreeBoost",duration:6e5,image:"/img/shop/itens/kit.gif"},{id:"ad_free_boost_20m",name:(0,o.t)("shop_item_boost_20m_name",e),description:(0,o.t)("shop_item_boost_desc",e),price:.5,currency:"RON",type:"EQUIPMENT",buffName:"adFreeBoost",duration:12e5,image:"/img/shop/itens/kit.gif"},{id:"ad_free_boost_40m",name:(0,o.t)("shop_item_boost_40m_name",e),description:(0,o.t)("shop_item_boost_desc",e),price:1.55,currency:"RON",type:"EQUIPMENT",buffName:"adFreeBoost",duration:24e5,image:"/img/shop/itens/kit.gif"},{id:"auto_play_unlock_insu",name:(0,o.t)("shop_item_auto_play_name",e),description:(0,o.t)("shop_item_auto_play_desc",e),price:1e3,currency:"INSU",type:"PERMANENT_BUFF",buffName:"autoClick",image:"/img/shop/itens/chip.gif"},{id:"auto_play_unlock_vida",name:(0,o.t)("shop_item_auto_play_name",e),description:(0,o.t)("shop_item_auto_play_desc",e),price:100,currency:"VIDA",type:"PERMANENT_BUFF",buffName:"autoClick",image:"/img/shop/itens/chip.gif"},{id:"auto_play_unlock_ron",name:(0,o.t)("shop_item_auto_play_name",e),description:(0,o.t)("shop_item_auto_play_desc",e),price:100,currency:"RON",type:"PERMANENT_BUFF",buffName:"autoClick",image:"/img/shop/itens/chip.gif"},{id:"spins_10",name:(0,o.t)("shop_item_spins_10_name",e),description:(0,o.t)("shop_item_spins_10_desc",e),price:100,currency:"ZOLG",type:"INVENTORY",itemName:"freeSpins",amount:10,image:"/img/shop/itens/sorte.gif"},{id:"spins_100",name:(0,o.t)("shop_item_spins_100_name",e),description:(0,o.t)("shop_item_spins_100_desc",e),price:50,currency:"VIDA",type:"INVENTORY",itemName:"freeSpins",amount:100,image:"/img/shop/itens/sorte.gif"},{id:"spins_1000",name:(0,o.t)("shop_item_spins_1000_name",e),description:(0,o.t)("shop_item_spins_1000_desc",e),price:15.5,currency:"RON",type:"INVENTORY",itemName:"freeSpins",amount:1e3,image:"/img/shop/itens/sorte.gif"},{id:"premium_pass_5d",name:(0,o.t)("shop_item_premium_5d_name",e),description:(0,o.t)("shop_item_premium_5d_desc",e),price:5,currency:"RON",type:"TIMED_BUFF",buffName:"premiumPass",duration:432e6,image:"/img/shop/itens/premium.gif"},{id:"premium_pass_15d",name:(0,o.t)("shop_item_premium_15d_name",e),description:(0,o.t)("shop_item_premium_15d_desc",e),price:9,currency:"RON",type:"TIMED_BUFF",buffName:"premiumPass",duration:1296e6,image:"/img/shop/itens/premium.gif"},{id:"premium_pass_50d",name:(0,o.t)("shop_item_premium_50d_name",e),description:(0,o.t)("shop_item_premium_50d_desc",e),price:40,currency:"RON",type:"TIMED_BUFF",buffName:"premiumPass",duration:432e7,image:"/img/shop/itens/premium.gif"}];async function handler(e,t){if("POST"!==e.method)return t.status(405).json({message:"Method not allowed"});let{userWallet:i,itemId:a}=e.body;if(!i||!a)return t.status(400).json({message:"Missing user wallet or item ID."});try{let e=await loadGameState(i);if(!e)return t.status(404).json({message:"Player state not found."});let s=getShopItems("en"),r=s.find(e=>e.id===a);if(!r)return t.status(404).json({message:"Item not found in shop."});let n=e.balances[r.currency]||0;if(n<r.price)return t.status(400).json({message:"Insufficient funds."});switch(e.balances[r.currency]-=r.price,r.type){case"EQUIPMENT":e.inventory=e.inventory||{};let o=e.inventory[r.id]||{...r,quantity:0};e.inventory[r.id]={...o,quantity:o.quantity+1};break;case"PERMANENT_BUFF":e.permanentBuffs=e.permanentBuffs||{},e.permanentBuffs[r.buffName]=!0}await saveGameState(i,e),t.status(200).json({message:"Purchase successful!",newBalances:e.balances,newInventory:e.inventory,newPermanentBuffs:e.permanentBuffs})}catch(e){console.error(`[API /buy-item] Error: ${e.message}`),t.status(500).json({message:"An internal server error occurred."})}}let m=(0,n.l)(a,"default"),p=(0,n.l)(a,"config"),c=new s.PagesAPIRouteModule({definition:{kind:r.x.PAGES_API,page:"/api/shop/buy-item",pathname:"/api/shop/buy-item",bundlePath:"",filename:""},userland:a})}};var t=require("../../../webpack-api-runtime.js");t.C(e);var __webpack_exec__=e=>t(t.s=e),i=t.X(0,[4222,9716],()=>__webpack_exec__(6946));module.exports=i})();