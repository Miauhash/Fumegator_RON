"use strict";(()=>{var e={};e.id=7349,e.ids=[7349],e.modules={3524:e=>{e.exports=require("@prisma/client")},145:e=>{e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},1069:(e,a,t)=>{t.r(a),t.d(a,{config:()=>d,default:()=>c,routeModule:()=>m});var s={};t.r(s),t.d(s,{default:()=>handler});var r=t(1802),i=t(7153),n=t(6249),l=t(7864),o=t(6282);let u=["INSULINE","ZOLGENSMA","LUXUTURNA","ZYNTEGLO"];async function handler(e,a){if("POST"!==e.method)return a.status(405).json({message:"Method Not Allowed"});let{sellerWallet:t,tokenType:s,amount:r,pricePerUnitInVIDA:i}=e.body,n=parseFloat(r),c=parseFloat(i);if(!t||!u.includes(s)||isNaN(n)||n<=0||isNaN(c)||c<=0)return a.status(400).json({message:"Invalid input data."});try{let e=await l.Z.marketListing.count({where:{sellerWallet:t,isActive:!0}});if(e>=3)return a.status(403).json({message:"You can only have 3 active listings at a time."});let r=await (0,o.u)(t);if(!r||!r.balances)return a.status(404).json({message:"Player game state not found."});let i=parseFloat(r.balances[s]||0);if(i<n)return a.status(400).json({message:"Insufficient token balance."});r.balances[s]=i-n,await (0,o.i)(t,r);let u=await l.Z.marketListing.create({data:{sellerWallet:t,tokenType:s,amount:n,pricePerUnitInVIDA:c,isActive:!0}});a.status(201).json({message:"Listing created successfully!",listing:u})}catch(e){console.error("Error creating market listing:",e),a.status(500).json({message:"Internal server error."})}}let c=(0,n.l)(s,"default"),d=(0,n.l)(s,"config"),m=new r.PagesAPIRouteModule({definition:{kind:i.x.PAGES_API,page:"/api/market/create",pathname:"/api/market/create",bundlePath:"",filename:""},userland:s})},7864:(e,a,t)=>{let s;t.d(a,{Z:()=>i});var r=t(3524);console.log("INICIALIZANDO PRISMA CLIENT. CONECTANDO AO BANCO DE DADOS:",process.env.DATABASE_URL),global.prisma||(global.prisma=new r.PrismaClient),s=global.prisma;let i=s}};var a=require("../../../webpack-api-runtime.js");a.C(e);var __webpack_exec__=e=>a(a.s=e),t=a.X(0,[4222,6282],()=>__webpack_exec__(1069));module.exports=t})();