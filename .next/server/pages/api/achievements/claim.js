"use strict";(()=>{var e={};e.id=9568,e.ids=[9568],e.modules={3524:e=>{e.exports=require("@prisma/client")},145:e=>{e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},4480:(e,a,r)=>{r.r(a),r.d(a,{config:()=>u,default:()=>c,routeModule:()=>_});var t={};r.r(t),r.d(t,{default:()=>handler});var i=r(1802),d=r(7153),l=r(6249),o=r(7864),s=r(6617);let n=[{id:"level_5",reward:10},{id:"level_18",reward:10},{id:"level_27",reward:10},{id:"level_39",reward:10},{id:"level_45",reward:10},{id:"level_60",reward:100},{id:"level_85",reward:100},{id:"level_97",reward:100},{id:"level_110",reward:100},{id:"level_140",reward:1e3},{id:"level_183",reward:1e3},{id:"level_201",reward:1e3},{id:"level_211",reward:1e3},{id:"level_223",reward:1e3},{id:"level_237",reward:1e3},{id:"level_246",reward:1e3},{id:"level_250",reward:5e3,specialReward:"NFT_LEGENDARY"}];async function handler(e,a){if("POST"!==e.method)return a.status(405).json({error:"M\xe9todo n\xe3o permitido."});let{wallet:r}=e.body;if(!r)return a.status(400).json({error:"A carteira do usu\xe1rio \xe9 obrigat\xf3ria."});try{let e=await o.Z.userAchievement.findMany({where:{userWallet:r,isClaimed:!1}});if(0===e.length)return a.status(400).json({error:"Nenhuma recompensa para coletar."});let t=0,i=!1;for(let a of e){let e=n.find(e=>e.id===a.achievementId);e&&(t+=e.reward,"NFT_LEGENDARY"===e.specialReward&&(i=!0))}await o.Z.$transaction(async a=>{let i=await a.gameState.findUnique({where:{wallet:r}});if(!i)throw Error("GameState n\xe3o encontrado.");let d=i.state;d.balances.VIDA=(d.balances.VIDA||0)+t,await a.gameState.update({where:{wallet:r},data:{state:d}});let l=e.map(e=>e.id);await a.userAchievement.updateMany({where:{id:{in:l}},data:{isClaimed:!0}})});let d=null;if(i)try{d=await (0,s.Q)(r,"SEU_ENDERECO_DE_CONTRATO_DE_NFT_LENDARIO_AQUI",123)}catch(e){console.error(`FALHA CR\xcdTICA: N\xe3o foi poss\xedvel transferir o NFT Lend\xe1rio para ${r}. Hash da transa\xe7\xe3o: ${d}`,e)}let l=`Recompensas coletadas! Voc\xea ganhou ${t} VIDA.`;i&&(l+=" E um NFT Lend\xe1rio foi enviado para sua carteira!"),a.status(200).json({message:l})}catch(e){console.error("Erro ao coletar recompensas:",e),a.status(500).json({error:"N\xe3o foi poss\xedvel coletar as recompensas."})}}let c=(0,l.l)(t,"default"),u=(0,l.l)(t,"config"),_=new i.PagesAPIRouteModule({definition:{kind:d.x.PAGES_API,page:"/api/achievements/claim",pathname:"/api/achievements/claim",bundlePath:"",filename:""},userland:t})}};var a=require("../../../webpack-api-runtime.js");a.C(e);var __webpack_exec__=e=>a(a.s=e),r=a.X(0,[4222,4045],()=>__webpack_exec__(4480));module.exports=r})();