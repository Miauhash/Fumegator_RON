"use strict";(()=>{var e={};e.id=2486,e.ids=[2486],e.modules={3524:e=>{e.exports=require("@prisma/client")},145:e=>{e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},4373:(e,r,t)=>{t.r(r),t.d(r,{config:()=>p,default:()=>m,routeModule:()=>w});var o={};t.r(o),t.d(o,{default:()=>f});var n=t(1802),a=t(7153),i=t(6249),s=t(7864),d=t(6117);!function(){var e=Error("Cannot find module 'ethers'");throw e.code="MODULE_NOT_FOUND",e}();let u=process.env.RONIN_CLUSTER||"saigon",c="mainnet"===u?"https://api.roninchain.com/rpc":"https://saigon-testnet.roninchain.com/rpc",l={INSULINE:"0x...",ZOLGENSMA:"0x...",LUXUTURNA:"0x...",ZYNTEGLO:"0x...",VIDA:"0x..."},h=["function transfer(address to, uint256 amount) returns (bool)","function decimals() view returns (uint8)"];async function handler(e,r){if("POST"!==e.method)return r.status(405).json({ok:!1,error:"Method not allowed"});try{let{wallet:t,tokenKey:o}=e.body,n=l[o];if(!t||!o||!n)return r.status(400).json({ok:!1,error:"Dados inv\xe1lidos ou token desconhecido"});let a=await s.Z.gameState.findUnique({where:{wallet:t}}),i=a?.state;if(!a||!i?.balances)return r.status(404).json({ok:!1,error:"Usu\xe1rio ou saldos n\xe3o encontrados"});let d=Number(i.balances[o]||0);if(d<10)return r.status(400).json({ok:!1,error:"Saque m\xednimo \xe9 10 tokens"});let u=process.env.GAME_WALLET_PRIVATE_KEY;if(!u)throw Error("Carteira do jogo n\xe3o configurada no servidor.");let f=Object(function(){var e=Error("Cannot find module 'ethers'");throw e.code="MODULE_NOT_FOUND",e}()).providers.JsonRpcProvider(c),m=Object(function(){var e=Error("Cannot find module 'ethers'");throw e.code="MODULE_NOT_FOUND",e}()).Wallet(u,f),p=Object(function(){var e=Error("Cannot find module 'ethers'");throw e.code="MODULE_NOT_FOUND",e}()).Contract(n,h,m),w=await p.decimals(),O=Number.isFinite(d)?Object(function(){var e=Error("Cannot find module 'ethers'");throw e.code="MODULE_NOT_FOUND",e}()).utils.parseUnits(d.toString(),w):Object(function(){var e=Error("Cannot find module 'ethers'");throw e.code="MODULE_NOT_FOUND",e}()).BigNumber.from(0);if(O.isZero())return r.status(400).json({ok:!1,error:"Saldo insuficiente"});let _=await p.transfer(t,O);await _.wait(),i.balances[o]=0,await s.Z.gameState.update({where:{wallet:t},data:{state:i}}),await s.Z.withdrawTransaction.create({data:{wallet:t,token:o,amount:d,signature:_.hash}});let E=`https://app.roninchain.com/tx/${_.hash}`;return r.status(200).json({ok:!0,signature:_.hash,explorerLink:E})}catch(t){console.error("[ERRO NA API DE WITHDRAW]",t);let e=t.reason||t.message||"Erro interno no servidor";return r.status(500).json({ok:!1,error:e})}}let f=(0,d.q)(5,6e5)(handler),m=(0,i.l)(o,"default"),p=(0,i.l)(o,"config"),w=new n.PagesAPIRouteModule({definition:{kind:a.x.PAGES_API,page:"/api/withdraw",pathname:"/api/withdraw",bundlePath:"",filename:""},userland:o})}};var r=require("../../webpack-api-runtime.js");r.C(e);var __webpack_exec__=e=>r(r.s=e),t=r.X(0,[4222,2056],()=>__webpack_exec__(4373));module.exports=t})();