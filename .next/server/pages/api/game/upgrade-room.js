"use strict";(()=>{var e={};e.id=5895,e.ids=[5895],e.modules={3524:e=>{e.exports=require("@prisma/client")},145:e=>{e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},9544:(e,a,s)=>{s.r(a),s.d(a,{config:()=>c,default:()=>m,routeModule:()=>p});var r={};s.r(r),s.d(r,{default:()=>u});var t=s(1802),o=s(7153),i=s(6249);s(7864);var n=s(6282),l=s(6117);let calcProgression=e=>({time:Math.round(60*Math.pow(7200,(e-1)/249)),reward:.001*Math.pow(24e3,(e-1)/249)});async function handler(e,a){if("POST"!==e.method)return a.status(405).json({message:"Method Not Allowed"});let{wallet:s,roomId:r,roomToken:t}=e.body;if(!s||!r||!t)return a.status(400).json({message:"Dados inv\xe1lidos."});try{let e=await (0,n.u)(s);if(!e)return a.status(404).json({message:"Jogador n\xe3o encontrado."});let o=e.levels?.[r]||1,i=e.costs?.[r]||1,l=e.balances?.[t]||0;if(o>=250)return a.status(400).json({message:"N\xedvel m\xe1ximo j\xe1 atingido."});if(l<i)return a.status(400).json({message:"Saldo insuficiente."});let d=o+1;e.balances[t]-=i,e.levels[r]=d,e.costs[r]=Math.ceil(1.15*i);let u=calcProgression(d);e.maxTimes[r]=u.time,e.rewards[r]=u.reward,e.playerStats.maxLevelReached=Math.max(e.playerStats.maxLevelReached||1,d),await (0,n.i)(s,e),a.status(200).json({message:"Upgrade bem-sucedido!",newGameState:{balances:e.balances,levels:e.levels,costs:e.costs,maxTimes:e.maxTimes,rewards:e.rewards,playerStats:e.playerStats}})}catch(e){console.error(`Error upgrading room for ${s}:`,e),a.status(500).json({message:"Erro interno do servidor."})}}let d=(0,l.q)(30,6e4)(handler),u=d,m=(0,i.l)(r,"default"),c=(0,i.l)(r,"config"),p=new t.PagesAPIRouteModule({definition:{kind:o.x.PAGES_API,page:"/api/game/upgrade-room",pathname:"/api/game/upgrade-room",bundlePath:"",filename:""},userland:r})}};var a=require("../../../webpack-api-runtime.js");a.C(e);var __webpack_exec__=e=>a(a.s=e),s=a.X(0,[4222,2056,6282],()=>__webpack_exec__(9544));module.exports=s})();