"use strict";(()=>{var e={};e.id=6786,e.ids=[6786],e.modules={3524:e=>{e.exports=require("@prisma/client")},145:e=>{e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},7307:(e,a,t)=>{t.r(a),t.d(a,{config:()=>u,default:()=>d,routeModule:()=>p});var r={};t.r(r),t.d(r,{default:()=>handler});var n=t(1802),s=t(7153),i=t(6249),o=t(7864);let l=process.env.ADMIN_SECRET_KEY;async function handler(e,a){if("POST"!==e.method)return a.status(405).json({message:"M\xe9todo n\xe3o permitido."});let{authorization:t}=e.headers;if(t!==`Bearer ${l}`)return a.status(403).json({message:"Acesso negado."});try{let e=await o.Z.playerStat.findMany({orderBy:{weeklyScore:"desc"},take:3,where:{weeklyScore:{gt:0}}});if(0===e.length)return await o.Z.playerStat.updateMany({data:{weeklyScore:0}}),a.status(200).json({message:"Nenhum jogador pontuou esta semana. Ranking zerado."});let t="SPECIAL_RANKING_NFT_WINNER_S1";for(let a of e)await o.Z.inventory.upsert({where:{userWallet_itemId:{userWallet:a.userWallet,itemId:t}},update:{quantity:{increment:1}},create:{userWallet:a.userWallet,itemId:t,quantity:1}});await o.Z.playerStat.updateMany({data:{weeklyScore:0}});let r=e.map(e=>e.userWallet).join(", ");a.status(200).json({message:`Ranking finalizado! Pr\xeamios enviados para as wallets: ${r}. A pontua\xe7\xe3o semanal foi zerada.`})}catch(e){console.error("Erro ao finalizar o ranking:",e),a.status(500).json({message:"Erro interno no servidor."})}}let d=(0,i.l)(r,"default"),u=(0,i.l)(r,"config"),p=new n.PagesAPIRouteModule({definition:{kind:s.x.PAGES_API,page:"/api/ranking/finalize",pathname:"/api/ranking/finalize",bundlePath:"",filename:""},userland:r})},7864:(e,a,t)=>{let r;t.d(a,{Z:()=>s});var n=t(3524);console.log("INICIALIZANDO PRISMA CLIENT. CONECTANDO AO BANCO DE DADOS:",process.env.DATABASE_URL),global.prisma||(global.prisma=new n.PrismaClient),r=global.prisma;let s=r}};var a=require("../../../webpack-api-runtime.js");a.C(e);var __webpack_exec__=e=>a(a.s=e),t=a.X(0,[4222],()=>__webpack_exec__(7307));module.exports=t})();