"use strict";(()=>{var e={};e.id=671,e.ids=[671],e.modules={3524:e=>{e.exports=require("@prisma/client")},145:e=>{e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},89:(e,a,t)=>{t.r(a),t.d(a,{config:()=>x,default:()=>p,routeModule:()=>c});var r={};t.r(r),t.d(r,{default:()=>l});var o=t(1802),i=t(7153),n=t(6249),s=t(7864),d=t(6117);async function handler(e,a){if("POST"!==e.method)return a.status(405).json({message:"M\xe9todo n\xe3o permitido."});let{userWallet:t,expeditionId:r}=e.body;if(!t||!r)return a.status(400).json({message:"Informa\xe7\xf5es incompletas para coletar a recompensa."});try{let e=await s.Z.$transaction(async e=>{let a=await e.expedition.findUnique({where:{id:r}});if(!a)throw Error("Expedi\xe7\xe3o n\xe3o encontrada.");if(a.userWallet!==t)throw Error("Voc\xea n\xe3o tem permiss\xe3o para coletar esta expedi\xe7\xe3o.");if(a.rewardClaimed)throw Error("A recompensa para esta expedi\xe7\xe3o j\xe1 foi coletada.");if(new Date<new Date(a.endsAt))throw Error("A expedi\xe7\xe3o ainda n\xe3o terminou.");let o=await e.gameState.findUnique({where:{wallet:t}});if(!o)throw Error("Estado do jogo n\xe3o encontrado para este usu\xe1rio.");let i=o.state,{rewardToken:n,rewardAmount:s}=a;i.balances[n]=(i.balances[n]||0)+s,await e.gameState.update({where:{wallet:t},data:{state:i}});let d=await e.expedition.update({where:{id:r},data:{rewardClaimed:!0}});return{updatedExpedition:d,rewardToken:n,rewardAmount:s}});a.status(200).json({message:`Recompensa de ${e.rewardAmount} ${e.rewardToken} coletada com sucesso!`,expedition:e.updatedExpedition})}catch(e){console.error("Erro ao coletar recompensa da expedi\xe7\xe3o:",e),a.status(400).json({message:e.message||"Erro interno no servidor."})}}let l=(0,d.q)(20,6e4)(handler),p=(0,n.l)(r,"default"),x=(0,n.l)(r,"config"),c=new o.PagesAPIRouteModule({definition:{kind:i.x.PAGES_API,page:"/api/expeditions/claim",pathname:"/api/expeditions/claim",bundlePath:"",filename:""},userland:r})}};var a=require("../../../webpack-api-runtime.js");a.C(e);var __webpack_exec__=e=>a(a.s=e),t=a.X(0,[4222,2056],()=>__webpack_exec__(89));module.exports=t})();